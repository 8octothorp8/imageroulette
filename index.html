<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tikolu Random Image Finder</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
    }
    img {
        max-width: 90%;
        max-height: 80vh;
        border: 2px solid #ccc;
        border-radius: 6px;
    }
</style>
</head>
<body>

<h2>Tikolu Random Image Finder</h2>

<div id="status">loading…</div>
<div id="details"></div>
<button id="showBtn" style="display:none;">show?</button>
<div id="img-container"></div>

<script>
function randomCode() {
    let letters = "abcdefghijklmnopqrstuvwxyz";
    let out = "";
    for (let i = 0; i < 5; i++) {
        out += letters[Math.floor(Math.random() * letters.length)];
    }
    return out;
}

function tryImage(url) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve("loaded");
        img.onerror = () => reject("error");
        img.src = url;
    });
}

async function findImage() {
    let attempts = 0;

    const status = document.getElementById("status");
    const details = document.getElementById("details");
    const showBtn = document.getElementById("showBtn");
    const container = document.getElementById("img-container");

    while (true) {
        attempts++;
        status.textContent = `Searching… tried ${attempts} codes`;

        let code = randomCode();
        let url = "https://tikolu.net/i/" + code;

        try {
            await tryImage(url);

            status.textContent = `Found after ${attempts} tries`;
            details.textContent = url;

            showBtn.onclick = () => {
                container.innerHTML = "";
                const img = document.createElement("img");
                img.src = url;
                container.appendChild(img);
            };

            showBtn.style.display = "inline-block";
            break;
        } catch {
            details.textContent = "Last attempt failed to load image";
        }
    }
}

findImage();
</script>

</body>
</html>
